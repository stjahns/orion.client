<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="/openajax/release/all/OpenAjaxManagedHub-all.js"></script>
	<script type="text/javascript" src="/js/plugin.js"></script>
	<script type="text/javascript" src="/js/gitClient.js"></script>
	<script type="text/javascript" src="/org.dojotoolkit/dojo/dojo.js.uncompressed.js"></script>
	<script>
		window.onload = function() {
			var provider = new eclipse.PluginProvider();
			var gitService = new eclipse.GitService();
			
			provider.registerServiceProvider("fileCommands", {
				run: function(item) {
					return "/git-status.html#" + item.Git.StatusLocation;
				}
			}, {
				name: "Git Status",
				id: "eclipse.git.status",
				tooltip: "Go to Git Status",
				validationProperties: {"Git":"*", "Directory":"true"},
				href: true,
				forceSingleItem: true
			});
			
			provider.registerServiceProvider("fileCommands", {
				run: function(item) {
					return "/git-log.html#" + item.Git.CommitLocation + "?page=1";
				}
			}, {
				name: "Git Log",
				id: "eclipse.git.log",
				tooltip: "Go to Git Log",
				validationProperties: {"Git":"*"},
				href: true,
				forceSingleItem: true
			});
			
			provider.registerServiceProvider("fileCommands", {
				run : function(item) {
					var clientDeferred = new dojo.Deferred();					
					gitService.getDefaultRemoteBranch(item.Git.RemoteLocation, function(defaultRemoteBranchJsonData, secondArg){
						clientDeferred.callback("/git-log.html?remote#" + defaultRemoteBranchJsonData.Location + "?page=1")
					});
					return clientDeferred;
				}
			}, {
				name: "Git Remote",
				id: "eclipse.git.remote",
				validationProperties: {"Git":"*"},
				forceSingleItem: true,
				href: true,
				tooltip: "Go to Git Remote"
			});
			
			provider.connect();
		};
	</script>
</head>
<body>
</body>
</html>